$(document).ready(function () {
    // необходимые настройки карты
    var defaultCoordinate = [42.87, 74.60];
    var leafletURL = 'https://api.mapbox.com/styles/v1/tsvetkovamariia/cited6yv400an2hrzaezesxtn/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoidHN2ZXRrb3ZhbWFyaWlhIiwiYSI6ImNpdGU4dnhvMTAwY2EyeW1qM216aDN3aHgifQ.D-AjvTmNye975Riw4LfT2A';

    // методы для взаимодействия с картой
    function moveMarker(e) {
        marker.setLatLng(e.latlng);
        mymap.panTo(e.latlng);
    }

    function resetMarker(){
        marker.setLatLng(defaultCoordinate);
        mymap.panTo(defaultCoordinate);
    }

    function updateFields() {
        fieldLatitude.value = marker.getLatLng().lat;
        fieldLongitude.value = marker.getLatLng().lng;
    }

    function updateMarker() {
        var lt = parseFloat(fieldLatitude.value);
        var ln = parseFloat(fieldLongitude.value);
        var newCoordinate = new L.LatLng(lt, ln);
        marker.setLatLng(newCoordinate);
        mymap.panTo(newCoordinate);
    }

    function organizationHasPosts(id, posts){
        var result = null;
        for(var i=0; i< posts.length; ++i)
        {
            if(posts[i].organization_id == id)
            {
                return posts[i];
            }
        }
        return result;

    }

    function createIcon(imageUrl){
        var newIcon = L.icon({
            iconUrl: imageUrl,
            iconSize: [38, 40],
            iconAnchor: [22, 42],
            popupAnchor: [-3, -45]
        });
        return newIcon;
    }

    function populateMap(map, data) {
        var organizations = data.organizations;
        var posts = data.posts;
        for (var i = 0; i < organizations.length; ++i)
        {
            var org = organizations[i];
            if(org.latitude && org.longitude)
            {
                var iconUrl = "";
                var orgCoordinate = new L.latLng(parseFloat(org.latitude), parseFloat(org.longitude));
                var popupContent = "";
                var post = organizationHasPosts(org.id, posts);
                if(post)
                {
                    iconUrl = '/assets/marker-important.svg';
                    popupContent = "<h5>" + org.name + "</h5><a href='/posts/"+ post.id +"'>"+ post.title +"</a>";
                } else
                {
                    iconUrl = '/assets/marker-default.svg';
                    popupContent = "<h5>" + org.name + "</h5><p>" + org.address + "</p>";
                }
                var marker = L.marker(orgCoordinate, {icon: createIcon(iconUrl)}).addTo(map);
                marker.bindPopup(popupContent);
            }
        }
    }

    // Карта на странице формы регистрации(organizations/new, edit)
    if (document.getElementById("map")!=null){
        var fieldLatitude  = document.getElementById('latitude');
        var fieldLongitude = document.getElementById('longitude');
        var btnReset = document.getElementById('map-reset');
        var mymap = L.map('map').setView(defaultCoordinate, 13);
        L.tileLayer(leafletURL, {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18
            }).addTo(mymap);
        var marker = L.marker(defaultCoordinate).addTo(mymap);
        fieldLatitude.value = marker.getLatLng().lat;
        fieldLongitude.value = marker.getLatLng().lng;
        mymap.on('click', function(e) {
            moveMarker(e);
            updateFields();
        });

        fieldLongitude.onkeydown = function() {updateMarker()} ;
        fieldLatitude.onkeydown = function() {updateMarker()} ;

        btnReset.onclick = function() {
            resetMarker();
            updateFields();
        };

        $('.pure-button').on('click', function(){
            mymap.locate({setView: true, maxZoom: 15});
        });

        mymap.on('locationfound', onLocationFound);
        function onLocationFound(e) {
            moveMarker(e);
            updateFields()
        }
    }


    // Карта на странице просмотра организации (organizations/show)
    if (document.getElementById("org-map")!=null){
        var orgLongitude = document.getElementById("org-longitude").innerHTML;
        var orgLatitude = document.getElementById("org-latitude").innerHTML;
        var coordinate = new L.latLng(parseFloat(orgLatitude), parseFloat(orgLongitude));
        var orgMap = L.map('org-map').setView(coordinate, 13);
        L.tileLayer(leafletURL, {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18
        }).addTo(orgMap);
        var marker = L.marker(coordinate).addTo(orgMap);

        $('.pure-button').on('click', function(){
            orgMap.locate({setView: true, maxZoom: 15});
        });

        orgMap.on('locationfound', onLocationFound);
        function onLocationFound(e) {
            iconUrl = '/assets/my_location.svg';
            L.marker(e.latlng, {icon: createIcon(iconUrl)}).addTo(orgMap);
        }
    }

    var placeData = {"type":"FeatureCollection","features":[
        {"type":"Feature",
        "geometry":{"type":"Polygon",
            "coordinates":[[
                [73.47930908203125,42.413318349422475],
                [73.5150146484375,42.439674178149424],
                [73.50677490234375,42.45588764197166],
                [73.4820556640625,42.46399280017058],
                [73.4490966796875,42.51057709842409],
                [73.44085693359375,42.63597933867727],
                [73.46282958984375,42.66830027189085],
                [73.46420288085938,42.73188302070198],
                [73.50540161132812,42.77221922375653],
                [73.51089477539062,42.78129125156277],
                [73.50540161132812,42.791369723650135],
                [73.51089477539062,42.837709559849614],
                [73.52325439453124,42.88602714832883],
                [73.51364135742188,42.92827401776912],
                [73.54385375976562,42.958432625269474],
                [73.55621337890625,42.984558134256076],
                [73.55758666992188,42.99862111927107],
                [73.5479736328125,43.00565140508583],
                [73.54660034179686,43.01569327500512],
                [73.56170654296875,43.0287452513488],
                [73.61251831054688,43.03978706404308],
                [73.63998413085936,43.04982335155648],
                [73.65921020507812,43.06387139555526],
                [73.72238159179688,43.08393444692567],
                [73.76495361328124,43.10599621690524],
                [73.80203247070312,43.111009147075116],
                [73.8336181640625,43.1270477646888],
                [73.88992309570311,43.11602166669343],
                [73.90090942382812,43.11802655958523],
                [73.91876220703125,43.12905229628564],
                [73.95858764648438,43.180145655844626],
                [73.96270751953125,43.198168406832046],
                [73.95309448242188,43.207177786666655],
                [73.96957397460938,43.22018898644747],
                [74.03961181640625,43.17113228474479],
                [74.07394409179688,43.18615383080433],
                [74.168701171875,43.19616614174528],
                [74.18655395507812,43.19416381095764],
                [74.20989990234375,43.19516498456403],
                [74.22088623046875,43.205175817237304],
                [74.19342041015624,43.25520534158046],
                [74.20303344726562,43.26620632572599],
                [74.23049926757812,43.25020423714625],
                [74.24972534179688,43.25445520209625],
                [74.25384521484375,43.252204728201605],
                [74.25350189208984,43.24970410411544],
                [74.25624847412108,43.2499541711442],
                [74.26071166992188,43.24595297548106],
                [74.2595100402832,43.243952279087424],
                [74.26139831542969,43.243389571387766],
                [74.26367282867432,43.243608402777454],
                [74.27156925201416,43.24646876936616],
                [74.27459478378296,43.24540591658798],
                [74.27865028381348,43.247422195049644],
                [74.27920818328857,43.249344630962874],
                [74.28051710128784,43.25026675348634],
                [74.2819333076477,43.249625957958386],
                [74.28285598754883,43.246484399415735],
                [74.28676128387451,43.24564037100088],
                [74.29169654846191,43.24248297582799],
                [74.29377794265747,43.241857729650384],
                [74.3031120300293,43.221314825150095],
                [74.30836677085607,43.21643604158223],
                [74.31538581848145,43.2190631269556],
                [74.31744575500488,43.21893803017322],
                [74.31856155395508,43.21631093845561],
                [74.31650161743164,43.21493479762263],
                [74.31838989257811,43.21412160889683],
                [74.3221664428711,43.217061547638735],
                [74.32714462280273,43.2164985916176],
                [74.33177947998047,43.219438415762795],
                [74.3341827392578,43.218437640477134],
                [74.33409690856934,43.21656114254328],
                [74.33083534240723,43.21299563737486],
                [74.33675765991211,43.211306641112685],
                [74.3378734588623,43.21224497814415],
                [74.3419075012207,43.20917969039356],
                [74.34079170227051,43.207177786666655],
                [74.34182167053223,43.204925566438945],
                [74.34860229492188,43.204863003578964],
                [74.35229301452637,43.20211017421873],
                [74.3532371520996,43.19866896283793],
                [74.35907363891602,43.19741756512383],
                [74.37272071838379,43.20067114579822],
                [74.37400817871094,43.19616614174528],
                [74.38465118408203,43.19735499456444],
                [74.39057350158691,43.194038663101935],
                [74.39126014709473,43.18947059072979],
                [74.39804077148438,43.19178595781361],
                [74.4049072265625,43.18665448536072],
                [74.3994140625,43.18264913393603],
                [74.40662384033203,43.17513839170044],
                [74.41486358642578,43.17588950749863],
                [74.41486358642578,43.17013071694503],
                [74.42413330078125,43.173385752242844],
                [74.43065643310547,43.16512263158296],
                [74.47528839111328,43.15235015543291],
                [74.49691772460938,43.156607944138194],
                [74.51408386230469,43.1438336880708],
                [74.53674316406249,43.13631817264693],
                [74.54944610595703,43.14182964095191],
                [74.56352233886719,43.13932448967272],
                [74.56523895263672,43.12980397869853],
                [74.57656860351562,43.13230952002388],
                [74.60128784179688,43.10775078916465],
                [74.59957122802734,43.101484228734684],
                [74.60334777832031,43.10123355297478],
                [74.62326049804688,43.08167768154824],
                [74.6352767944336,43.07891929985966],
                [74.64317321777344,43.058854606434494],
                [74.67063903808594,43.04079076668198],
                [74.69398498535156,43.037277735611376],
                [74.74891662597656,42.98857645832184],
                [74.77638244628906,42.99661231842139],
                [74.83131408691406,43.002638523957906],
                [74.87319946289062,42.99159002898986],
                [74.87937927246094,42.983051195010646],
                [74.8915672302246,42.98204654832571],
                [74.90564346313477,42.971747973268855],
                [74.91628646850586,42.971371163427406],
                [74.92727279663086,42.96546750784811],
                [74.92263793945312,42.96257827841771],
                [74.93619918823242,42.96408571939765],
                [74.97559547424316,42.944580349496036],
                [74.98048782348633,42.945931162088435],
                [74.99610900878906,42.94172155534018],
                [75.03713607788086,42.92048064294055],
                [75.05035400390625,42.92286903999822],
                [75.08056640625,42.91419494510531],
                [75.13687133789061,42.88451779606897],
                [75.19798278808594,42.870931963933735],
                [75.19729614257812,42.86489285618648],
                [75.23162841796875,42.852812868190014],
                [75.29617309570312,42.86187308074834],
                [75.41839599609375,42.838716561950726],
                [75.47882080078125,42.842744406244606],
                [75.71365356445311,42.79540065303723],
                [75.82489013671875,42.938328528472546],
                [75.93475341796875,42.95441233121331],
                [76.02710723876953,42.911177582396384],
                [76.19430541992188,42.93129054333758],
                [76.20014190673828,42.91670930118165],
                [76.23756408691406,42.920983471068055],
                [76.30210876464844,42.91017176199848],
                [76.30828857421875,42.89885515150089],
                [76.2997055053711,42.88753646365934],
                [76.30416870117188,42.87344808444721],
                [76.343994140625,42.860614797387974],
                [76.47994995117188,42.88602714832883],
                [76.51153564453125,42.91922355466844],
                [76.70379638671874,42.90313055962194],
                [76.7779541015625,42.956422511073335],
                [76.9976806640625,42.98355351219673],
                [77.35198974609375,42.899106654303075],
                [77.5360107421875,42.93631775765237],
                [77.93701171875,42.87596410238256],
                [78.189697265625,42.879989517714826],
                [78.486328125,42.89206418807337],
                [79.0191650390625,42.771211138625894],
                [79.1949462890625,42.79943131987838],
                [79.1839599609375,42.70262285884388],
                [79.508056640625,42.459940352216556],
                [79.95849609375,42.4275113263909],
                [80.1727294921875,42.21021084387633],
                [80.13015747070312,42.16645713841854],
                [80.22766113281249,42.06254817666338],
                [80.19744873046875,42.03501434990212],
                [80.13839721679688,42.02991418347818],
                [79.96536254882812,42.04113400940807],
                [79.84451293945312,42.0125705565935],
                [79.8486328125,41.9829734519797],
                [79.76760864257812,41.89205502378826],
                [79.63302612304688,41.891032732083765],
                [79.56436157226562,41.840920397579936],
                [79.48471069335938,41.83682786072714],
                [79.46548461914062,41.852173524388824],
                [79.35150146484375,41.792816561051815],
                [79.31991577148438,41.80714914168836],
                [79.21142578125,41.725205507257016],
                [79.12628173828125,41.72213058512578],
                [79.02603149414062,41.67598909594535],
                [79.01641845703125,41.65649719441145],
                [78.99032592773438,41.66367910784373],
                [78.87359619140625,41.593878050033965],
                [78.86123657226562,41.59593210097788],
                [78.80767822265625,41.5579215778042],
                [78.7060546875,41.54764462357737],
                [78.64562988281249,41.469486382476376],
                [78.57353210449219,41.48080459927738],
                [78.5302734375,41.43860847395721],
                [78.387451171875,41.393294288784865],
                [78.23089599609375,41.399475357337565],
                [78.145751953125,41.36444153054222],
                [78.12103271484375,41.22824901518529],
                [77.969970703125,41.18072118284585],
                [77.89306640625,41.176586696571015],
                [77.80517578125,41.12488359929119],
                [77.816162109375,41.04621681452063],
                [77.76397705078125,41.0130657870063],
                [77.464599609375,41.00477542222947],
                [77.35748291015625,41.03585891144301],
                [77.2613525390625,41.00270266805319],
                [77.2283935546875,41.02964338716638],
                [77.17620849609375,41.008920735004885],
                [76.9921875,41.071069130806414],
                [76.7340087890625,40.89275342420696],
                [76.673583984375,40.772221877329024],
                [76.640625,40.75557964275589],
                [76.6461181640625,40.61812224225511],
                [76.409912109375,40.38002840251183],
                [76.3385009765625,40.33817045213394],
                [76.278076171875,40.43022363450862],
                [76.1517333984375,40.36328834091583],
                [75.9649658203125,40.371658891506094],
                [75.9100341796875,40.29209669470104],
                [75.816650390625,40.317231732315236],
                [75.69030761718749,40.27952566881291],
                [75.6683349609375,40.40094763151963],
                [75.7122802734375,40.463666324587685],
                [75.62713623046875,40.538851525354666],
                [75.58319091796875,40.657722371758105],
                [75.21240234375,40.44276659332215],
                [75.08056640625,40.43440488077008],
                [74.83337402343749,40.509622849596695],
                [74.79766845703125,40.43858586704331],
                [74.90753173828125,40.34445080136368],
                [74.8553466796875,40.32141999593439],
                [74.69329833984375,40.34235741658335],
                [74.6466064453125,40.271143686084194],
                [74.58892822265625,40.27743027053821],
                [74.33624267578125,40.09067983779908],
                [74.2510986328125,40.12849105685408],
                [74.0643310546875,40.082274490356966],
                [74.0423583984375,40.092781012494065],
                [73.93524169921875,40.02551125229787],
                [73.97918701171875,40.00447583427404],
                [73.828125,39.757879992021756],
                [73.89404296875,39.740986355883564],
                [73.93798828125,39.592990390285024],
                [73.86657714843749,39.47860556892209],
                [73.5589599609375,39.45316112807394],
                [73.3941650390625,39.444677580473424],
                [73.32275390625,39.37677199661635],
                [73.1524658203125,39.35129035526705],
                [72.784423828125,39.34704251121735],
                [72.61962890625,39.38526381099774],
                [72.5537109375,39.35129035526705],
                [72.5262451171875,39.38101803294523],
                [72.3175048828125,39.308800296002914],
                [72.235107421875,39.16414104768742],
                [72.037353515625,39.364032338047984],
                [71.89453125,39.27478966170308],
                [71.78466796874999,39.27053717095511],
                [71.806640625,39.38526381099774],
                [71.7681884765625,39.44891948347229],
                [71.5484619140625,39.44891948347229],
                [71.5484619140625,39.57182223734374],
                [71.48391723632812,39.609920257000795],
                [71.3067626953125,39.52099229357195],
                [71.2518310546875,39.53793974517628],
                [71.103515625,39.487084981687495],
                [71.05957031249999,39.410733055084954],
                [70.77392578125,39.38526381099774],
                [70.587158203125,39.58875727696545],
                [70.29052734375,39.52946653645165],
                [70.103759765625,39.57182223734374],
                [69.86480712890625,39.53158493558714],
                [69.6917724609375,39.59933957529531],
                [69.63958740234375,39.58452390500424],
                [69.59564208984375,39.58452390500424],
                [69.5709228515625,39.552765371831015],
                [69.48028564453125,39.523110951240696],
                [69.400634765625,39.55911824217184],
                [69.36492919921875,39.51887357127223],
                [69.334716796875,39.53793974517628],
                [69.35943603515625,39.592990390285024],
                [69.3182373046875,39.67759833072648],
                [69.334716796875,39.69450749856091],
                [69.2633056640625,39.81908469086112],
                [69.32373046875,39.87812720644829],
                [69.29901123046875,39.91605629078665],
                [69.35394287109375,39.970805680527725],
                [69.34844970703125,40.01709786313761],
                [69.43084716796875,39.98343393295322],
                [69.4281005859375,39.92237576385941],
                [69.532470703125,39.93922484079194],
                [69.5050048828125,40.029717557833266],
                [69.54345703125,40.11799004890473],
                [69.57366943359375,40.10118506258701],
                [69.64508056640625,40.11799004890473],
                [69.6697998046875,40.10538669840983],
                [70.00762939453125,40.2313150803688],
                [70.1751708984375,40.14109012528468],
                [70.18890380859375,40.166281254206545],
                [70.21087646484375,40.12639098502455],
                [70.57891845703125,40.000267972646796],
                [70.49102783203125,39.93711893299021],
                [70.653076171875,39.98343393295322],
                [70.6640625,40.094882122321145],
                [70.78765869140625,40.12849105685408],
                [70.79864501953125,40.176774799905445],
                [70.828857421875,40.18307014852534],
                [70.8343505859375,40.16208338164617],
                [70.97442626953125,40.21873275657034],
                [70.96206665039062,40.26590441926665],
                [70.96343994140625,40.286859051369504],
                [71.01974487304688,40.295239085867614],
                [71.0321044921875,40.27952566881291],
                [71.07330322265625,40.28895415740959],
                [71.12823486328125,40.33817045213394],
                [71.20376586914062,40.34445080136368],
                [71.25045776367188,40.330842639095756],
                [71.24771118164062,40.32377578004119],
                [71.2738037109375,40.34314244348888],
                [71.3009262084961,40.33058091676979],
                [71.29234313964844,40.32508451346655],
                [71.30985260009766,40.306759936589636],
                [71.32427215576172,40.317231732315236],
                [71.33594512939453,40.316969957212294],
                [71.33560180664062,40.3130432088809],
                [71.34658813476562,40.31461393561548],
                [71.34624481201172,40.318540592606354],
                [71.36890411376953,40.31827882257792],
                [71.37714385986328,40.31409036409682],
                [71.3668441772461,40.30623630417918],
                [71.39087677001953,40.309116232201816],
                [71.39739990234375,40.30571266770939],
                [71.39945983886719,40.30152342981563],
                [71.41456604003906,40.29104919850652],
                [71.42829895019531,40.28397817452576],
                [71.45439147949219,40.27873990206998],
                [71.47911071777344,40.2748109313747],
                [71.48563385009766,40.27612061363972],
                [71.49078369140625,40.2740251098398],
                [71.50108337402344,40.27716834118786],
                [71.51206970214842,40.26459453914917],
                [71.51103973388672,40.24363300778246],
                [71.51756286621094,40.238915768434374],
                [71.51309967041016,40.23079086353824],
                [71.52202606201172,40.22554847206815],
                [71.53301239013672,40.22476207835184],
                [71.5594482421875,40.21611114495333],
                [71.57970428466797,40.214538129296336],
                [71.58004760742188,40.21820844236145],
                [71.59103393554688,40.21742196344075],
                [71.59515380859375,40.21112980344102],
                [71.61815643310547,40.207196906764054],
                [71.6202163696289,40.212702898212726],
                [71.61369323730469,40.22109212030118],
                [71.62879943847655,40.212440718286466],
                [71.62330627441406,40.225810601278205],
                [71.619873046875,40.23760536584024],
                [71.62193298339844,40.24834991844239],
                [71.61849975585938,40.25228042623786],
                [71.61918640136719,40.26695230509778],
                [71.64253234863281,40.26695230509778],
                [71.6806411743164,40.27009586518854],
                [71.68235778808594,40.255162653545],
                [71.69506072998047,40.24992214895231],
                [71.70021057128906,40.233411907115055],
                [71.69368743896484,40.22449994508436],
                [71.70536041259766,40.20169046802998],
                [71.69368743896484,40.20509926855807],
                [71.70021057128906,40.19198755915448],
                [71.67652130126953,40.19592133820191],
                [71.68270111083984,40.18831582616864],
                [71.70879364013672,40.176774799905445],
                [71.71222686767578,40.17939793281656],
                [71.72801971435547,40.14843850313905],
                [71.73419952392578,40.16234575628614],
                [71.74690246582031,40.16890479273627],
                [71.78466796874999,40.20300156544074],
                [71.83067321777344,40.21847059997307],
                [71.82861328125,40.241274429193886],
                [71.84165954589844,40.253590544777225],
                [71.86946868896484,40.25909276567395],
                [71.883544921875,40.26223669101846],
                [71.91444396972656,40.25647271628502],
                [71.92646026611328,40.25097028233546],
                [71.9278335571289,40.242322696489],
                [71.94156646728516,40.23708119770155],
                [71.96662902832031,40.244681238556815],
                [71.93950653076172,40.24966011307024],
                [71.94808959960936,40.25594869423264],
                [71.97830200195312,40.25647271628502],
                [72.00439453125,40.27585867921605],
                [72.02465057373047,40.26695230509778],
                [72.05314636230469,40.28319245953215],
                [72.0425033569336,40.28947792377229],
                [71.99169158935547,40.3012615938213],
                [71.9662857055664,40.31984942752469],
                [72.04765319824219,40.370089492456025],
                [72.04421997070312,40.37688995771414],
                [72.08885192871092,40.40460782849249],
                [72.08747863769531,40.45060475430765],
                [72.12936401367188,40.46000934086916],
                [72.18154907226562,40.49500373230525],
                [72.25296020507812,40.479336856947604],
                [72.24334716796875,40.46000934086916],
                [72.29690551757812,40.44276659332215],
                [72.31544494628906,40.44746959960371],
                [72.38822937011719,40.4035620782368],
                [72.41981506347656,40.40303919701655],
                [72.42118835449219,40.414541645611635],
                [72.41500854492188,40.42761022357258],
                [72.43904113769531,40.47150204787303],
                [72.37930297851562,40.51588721022959],
                [72.42599487304688,40.53937335015618],
                [72.3456573486328,40.60039879034164],
                [72.41020202636719,40.61864344909241],
                [72.47543334960938,40.54980899258771],
                [72.50564575195312,40.558678010242645],
                [72.57568359375,40.53572049118792],
                [72.64846801757812,40.509622849596695],
                [72.67318725585936,40.5930995321649],
                [72.75558471679688,40.57328324298059],
                [72.75146484374999,40.60039879034164],
                [72.80227661132812,40.675430613644295],
                [72.84759521484375,40.67647212850004],
                [72.87094116210938,40.71083299030839],
                [72.9986572265625,40.76598152771282],
                [73.13461303710938,40.78574062435701],
                [73.12225341796875,40.83874913796459],
                [73.02200317382812,40.83874913796459],
                [72.94235229492188,40.80029619806279],
                [72.83248901367188,40.85537053192494],
                [72.5921630859375,40.86991083161536],
                [72.5372314453125,40.96330795307353],
                [72.4932861328125,40.97575093157534],
                [72.34771728515625,41.054501963290505],
                [72.1856689453125,41.008920735004885],
                [72.1636962890625,41.16211393939692],
                [72.0648193359375,41.12488359929119],
                [71.861572265625,41.19932314127607],
                [71.69677734375,41.49623534616764],
                [71.5704345703125,41.290189955885644],
                [71.44958496093749,41.28606238749825],
                [71.400146484375,41.09591205639546],
                [70.7904052734375,41.17038447781618],
                [70.6915283203125,41.46742831254425],
                [70.48828125,41.40153558289846],
                [70.1641845703125,41.545589036668105],
                [70.587158203125,41.828642001860544],
                [70.828857421875,41.934976500546604],
                [70.86181640625,42.02481360781777],
                [70.960693359375,42.01665183556825],
                [71.268310546875,42.204107493733176],
                [70.87280273437499,42.27730877423709],
                [70.960693359375,42.47209690919285],
                [71.1474609375,42.601619944327965],
                [71.290283203125,42.771211138625894],
                [71.5869140625,42.76314586689492],
                [71.82861328125,42.8115217450979],
                [72.09228515625,42.71473218539458],
                [72.279052734375,42.73894375124377],
                [72.740478515625,42.64204079304426],
                [72.92724609375,42.53689200787315],
                [73.311767578125,42.50450285299051],
                [73.311767578125,42.439674178149424],
                [73.443603515625,42.44778143462245],
                [73.47930908203125,42.413318349422475]
            ]]
        }}
    ]};


    // Карта на главной странице
    if (document.getElementById("index-map")!=null){
        var indexMap = L.map('index-map').setView([41.25, 74.60], 7);
        L.tileLayer(leafletURL, {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18
        }).addTo(indexMap);

        $('.pure-button').on('click', function(){
            indexMap.locate({setView: true, maxZoom: 14});
        });

        indexMap.on('locationfound', onLocationFound);
        function onLocationFound(e) {
            iconUrl = '/assets/my_location.svg';
            L.marker(e.latlng, {icon: createIcon(iconUrl)}).addTo(indexMap);
        };

        function style(feature) {
            return {
                fillColor: '#FD8D3C',
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }

        L.geoJson(placeData).addTo(indexMap);

        $.ajax({
            type: "GET",
            url:  "/organizations/list",
            dataType: "json",
            success: function(data) {
                populateMap(indexMap, data);
            }
        });
    }
});
