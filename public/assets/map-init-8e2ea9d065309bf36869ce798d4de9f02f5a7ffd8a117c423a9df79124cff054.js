$(document).ready(function(){function t(t,a,e){var n=e||v,o=a||d,i=L.map(t).setView(o,n);return L.tileLayer(f,{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xa9 <a href="http://mapbox.com">Mapbox</a>',maxZoom:18}).addTo(i),i}function a(t){var a=t.event;t.marker.setLatLng(a.latlng),t.map.panTo(a.latlng)}function e(t){var a=t.coordinate||d;t.marker.setLatLng(a),t.map.panTo(a)}function n(t){t.fieldLatitude.value=t.marker.getLatLng().lat,t.fieldLongitude.value=t.marker.getLatLng().lng}function o(t){var a=parseFloat(t.fieldLatitude.value),e=parseFloat(t.fieldLongitude.value),n=new L.LatLng(a,e);t.marker.setLatLng(n),t.map.panTo(n)}function i(t,a){for(var e=null,n=0;n<a.length;++n)if(a[n].organization_id==t)return a[n];return e}function r(t){var a=L.icon({iconUrl:t,iconSize:[38,40],iconAnchor:[22,42],popupAnchor:[-3,-45]});return a}function u(t,a){var e={color:"#6cce44",opacity:1,weight:3,fillOpacity:0};L.geoJson(a,{style:e}).addTo(t)}function c(t,a){for(var e=a.organizations,n=a.posts,o=0;o<e.length;++o){var u=e[o];if(u.latitude&&u.longitude){var c="",l=new L.latLng(parseFloat(u.latitude),parseFloat(u.longitude)),s="",p=i(u.id,n);if(p){var m=p.body.substring(0,y);c=B,s="<h5><a href='/posts/"+p.id+"'>"+p.title+"</a></h5><p class='marker-post'>"+m+"</p><p>\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043b <a href='organizations/show/"+u.id+"'>"+u.name+"</a></p><a href='/posts/"+p.id+"' class='btn btn-success'>Details</a>"}else{c=k;var d=u.description||u.address;s="<h5><a href='organizations/show/'"+u.id+"></a>"+u.name+"</h5><p>"+d+"</p><a href='/organizations/show/"+u.id+"'>Details</a>"}var g=L.marker(l,{icon:r(c)}).addTo(t);g.bindPopup(s)}}}function l(t){function e(e){t.event=e,a(t),t.marker.bindPopup("\u0412\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0435\u0441\u044c \u0442\u0443\u0442").openPopup(),n(t)}t.userLocationButton.onclick=function(){t.map.locate({setView:!0,maxZoom:15})},t.map.on("locationfound",e)}function s(t,a){var e=a||v;t.userLocationButton.onclick=function(){t.map.locate({setView:!0,maxZoom:e})},t.map.on("locationfound",function(a){var e=L.marker(a.latlng,{icon:r(h)}).addTo(t.map);e.bindPopup("\u0412\u044b \u0442\u0443\u0442").openPopup()})}function p(t){t.map.on("click",function(e){t.event=e,a(t),n(t)}),t.fieldLongitude.oninput=function(){o(t)},t.fieldLatitude.oninput=function(){o(t)}}function m(t){t.resetMapButton.onclick=function(){e(t),n(t)}}var d=[42.87,74.6],g=[41.25,74.6],f="https://api.mapbox.com/styles/v1/tsvetkovamariia/cited6yv400an2hrzaezesxtn/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoidHN2ZXRrb3ZhbWFyaWlhIiwiYSI6ImNpdGU4dnhvMTAwY2EyeW1qM216aDN3aHgifQ.D-AjvTmNye975Riw4LfT2A",v=13,y=350,h="/assets/map/icon-marker-user.svg",k="/assets/map/icon-marker-ok.svg",B="/assets/map/icon-marker-alert.svg";if(null!=document.getElementById("new-organization-map")){var b=t("new-organization-map"),T=L.marker(d,{icon:r(k)}).addTo(b),I={map:b,marker:T,fieldLatitude:document.getElementById("latitude"),fieldLongitude:document.getElementById("longitude"),resetMapButton:document.getElementById("map-reset"),userLocationButton:document.getElementById("btn-locate-user")};n(I),p(I),m(I),l(I)}if(null!=document.getElementById("organization-map")){var w=parseFloat(document.getElementById("org-longitude").innerHTML),z=parseFloat(document.getElementById("org-latitude").innerHTML),E=new L.latLng(z,w),x=t("organization-map",E),T=L.marker(E,{icon:r(k)}).addTo(x);x.panTo(E);var M={marker:T,map:x,userLocationButton:document.getElementById("btn-locate-user")};s(M,13)}if(null!=document.getElementById("main-map")){var F=t("main-map",g,7),A={map:F,userLocationButton:document.getElementById("btn-locate-user")};s(A,14),u(A.map,placeData),$.ajax({type:"GET",url:"/organizations/list",dataType:"json",success:function(t){c(F,t)}})}});